!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("axios")):"function"==typeof define&&define.amd?define(["axios"],factory):(global=global||self).MelhorEnvio=factory(global.axios)}(this,(function(axios){"use strict";axios=axios&&Object.prototype.hasOwnProperty.call(axios,"default")?axios.default:axios;class MelhorEnvioFetchServerError extends Error{constructor(status){super(`Server error status ${status} `),this.name="MelhorEnvioFetchServerError"}}class MelhorEnvioFetchClientError extends Error{constructor(){super("Client error"),this.name="MelhorEnvioFetchClientError"}}class MelhorEnvioFetchOtherError extends Error{constructor(){super("Other Error"),this.name="MelhorEnvioFetchOtherError"}}var x,browser=function(fn,module){return fn(module={exports:{}},module.exports),module.exports}((function(module,exports){function percentToByte(p){return String.fromCharCode(parseInt(p.slice(1),16))}function byteToPercent(b){return"%"+("00"+b.charCodeAt(0).toString(16)).slice(-2)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.encode=function(str){return btoa(encodeURIComponent(str).replace(/%[0-9A-F]{2}/g,percentToByte))},exports.decode=function(str){return decodeURIComponent(Array.from(atob(str),byteToPercent).join(""))}}));(x=browser)&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")&&x.default;browser.encode;var browser_2=browser.decode;function MelhorEnvio(token,isSandbox=!1,timeout=5e3){if(!function(token){const tokenParts=token.split("."),timestamp=JSON.parse(browser_2(tokenParts[1])).exp;return new Date(1e3*timestamp)>new Date}(token))throw new Error("Expired token");this.token=token,this.isSandbox=isSandbox,this.timeout=timeout}return MelhorEnvio.prototype={},MelhorEnvio.prototype.constructor=MelhorEnvio,MelhorEnvio.prototype.fetch=async function(url,method="GET",params={},data={}){try{return(await axios({baseURL:this.isSandbox?"https://sandbox.melhorenvio.com.br":"https://www.melhorenvio.com.br",method:method,url:url,timeout:this.timeout,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+this.token},params:params,data:data})).data}catch(error){throw error.response?new MelhorEnvioFetchServerError(error.response.status):error.request?new MelhorEnvioFetchClientError:new MelhorEnvioFetchOtherError}},MelhorEnvio.prototype.getShipmentServices=async function(){return this.fetch("/api/v2/me/shipment/services","GET")},MelhorEnvio.prototype.calculateShipment=async function(fromPostalCode,toPostalCode,packageData={},productsData=[],services=[],receipt=!1,ownHand=!1,insuranceValue=0){const data={from:{postal_code:fromPostalCode},to:{postal_code:toPostalCode},options:{receipt:receipt,own_hand:ownHand,insurance_value:insuranceValue}};if(services.length>0&&(data.services=services.join(",")),Object.keys(packageData).length>0&&productsData.length>0)throw new Error("You need to choose between package or product to calculate shipment");return Object.keys(packageData).length>0?data.package=packageData:productsData.length>0&&(data.products=productsData),this.fetch("/api/v2/me/shipment/calculate","POST",{},data)},MelhorEnvio}));